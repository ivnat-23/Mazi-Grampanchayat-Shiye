<!DOCTYPE html>
<html>
<head>
  <title>D-ID Avatar Test</title>
  <meta charset="UTF-8" />
  <style>
    body { background:#111; color:white; font-family:Arial; padding:20px; }
    button { padding:10px 20px; font-size:16px; cursor:pointer; }
    video { width:400px; margin-top:20px; border-radius:10px; }
  </style>
</head>
<body>

<h2>D-ID AI Avatar Lip Sync Test</h2>
<button onclick="createVideo()">Generate 10-sec Avatar Video</button>

<p id="status"></p>
<video id="avatarVideo" controls></video>

<script>
  async function createVideo() {
    document.getElementById('status').innerText = "Creating video...";

    const apiKey = "YWthc2h2aXBhdGlsOTU1NUBnbWFpbC5jb20:JvTDbPd7fDXmQZnrx8DfZ";

    const scriptText = "Hello, this is a test of the D I D avatar system. This video is automatically generated using an API call, and it includes full lip sync. Thank you.";

    const payload = {
      script: {
        type: "text",
        input: scriptText,
        ssml: false
      },
      config: {
        fluent: true,
        pad_audio: 0
      },
      source_url: "https://create-images-results.d-id.com/mona_lisa.png" 
    };

    const response = await fetch("https://api.d-id.com/talks", {
      method: "POST",
      headers: {
        "Authorization": "Basic " + btoa(apiKey),
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();
    console.log(data);
    document.getElementById('status').innerText = "Video created. Waiting to be ready...";

    pollVideo(data.id, apiKey);
  }

  async function pollVideo(id, apiKey) {
    const interval = setInterval(async () => {
      const res = await fetch(`https://api.d-id.com/talks/${id}`, {
        headers: {
          "Authorization": "Basic " + btoa(apiKey)
        }
      });

      const result = await res.json();
      console.log(result);

      if (result.result_url) {
        clearInterval(interval);
        document.getElementById('status').innerText = "Video Ready!";
        document.getElementById('avatarVideo').src = result.result_url;
      }
    }, 2000);
  }
</script>
</body>
</html>
